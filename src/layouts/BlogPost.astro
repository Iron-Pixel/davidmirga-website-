---
import BaseLayout from './BaseLayout.astro';
import SocialCTA from '../components/SocialCTA.astro';

const { frontmatter } = Astro.props;
const content = await Astro.slots.render('default');
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

const categoryLabels: Record<string, string> = {
  'ki-sicherheit': 'KI-Sicherheit',
  'ki-praxis': 'KI-Praxis',
  'ki-strategie': 'KI-Strategie',
  'ki-wissen': 'KI-Wissen'
};

const displayCategory = categoryLabels[frontmatter.category] || frontmatter.category;
---

<BaseLayout pageTitle={frontmatter.title} description={frontmatter.description}>
  <article class="max-w-3xl mx-auto px-4 py-12">
    
    <header class="mb-10 text-center">
      <span class="inline-block bg-gray-100 text-[#DC2626] text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide mb-4">
        {displayCategory}
      </span>

      <h1 class="text-3xl md:text-4xl font-bold text-[#0B1F3F] mb-6 font-['Manrope'] leading-tight">
        {frontmatter.title}
      </h1>

      <div class="flex flex-wrap justify-center gap-4 text-sm text-gray-500">
        <span>{new Date(frontmatter.date).toLocaleDateString('de-AT')}</span>
        <span>•</span>
        <span>{frontmatter.author}</span>
        <span>•</span>
        <span>{readingTime} Min. Lesezeit</span>
      </div>
    </header>

    {frontmatter.image && (
      <div class="mb-10 w-full overflow-hidden rounded-xl shadow-md border border-gray-100">
        <img 
          src={frontmatter.image} 
          alt={frontmatter.title}
          class="w-full h-[250px] md:h-[350px] object-cover"
          loading="eager"
        />
      </div>
    )}

    {frontmatter.video && (
      <div class="aspect-video mb-10 rounded-xl overflow-hidden shadow-md">
        <iframe 
          src={frontmatter.video}
          class="w-full h-full"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
    )}

    <div class="prose prose-lg prose-slate max-w-none text-[#0B1F3F] 
                prose-headings:font-['Manrope'] prose-headings:text-[#0B1F3F] 
                prose-a:text-[#DC2626] prose-img:rounded-xl">
      <slot />
    </div>

    <div class="mt-16 pt-8 border-t-2 border-gray-100">
      <div class="bg-gradient-to-r from-[#0B1F3F] to-[#0B1F3F]/90 rounded-xl p-6 text-white shadow-lg md:flex md:items-center md:justify-between">
        <div class="mb-4 md:mb-0 md:mr-6">
          <h3 class="text-lg font-bold mb-2 font-['Manrope']">Mein Tipp:</h3>
          <p class="text-sm text-gray-200">
            Abonniere den <strong>KI im Puls</strong> Newsletter. Du bekommst professionelle Workflows, 
            praxisnahe Tools und klare Hintergrundinformationen – vieles abseits des Hypes.
          </p>
        </div>
        <a 
          href="/abonnieren" 
          class="inline-block px-6 py-3 bg-[#DC2626] text-white text-sm font-bold rounded-lg hover:bg-red-700 transition-colors whitespace-nowrap shadow-md"
        >
          Hier anmelden
        </a>
      </div>
    </div>

    <div class="mt-8">
      <div class="bg-gray-50 rounded-xl p-6 border-l-4 border-[#DC2626]">
        <p class="text-[#0B1F3F] text-sm">
          <strong>Falls du mehr zu mir und meinem Weg erfahren willst</strong> – und warum gerade ich diesen Artikel schreibe – 
          <a href="/ueber-mich" class="text-[#DC2626] font-semibold hover:underline">lies hier meine Geschichte (Über mich)</a>
        </p>
      </div>
    </div>

    <div class="mt-10">
      <SocialCTA 
        linkedin={frontmatter.linkedin}
        instagram={frontmatter.instagram}
        x={frontmatter.x}
      />
    </div>

  </article>
</BaseLayout>