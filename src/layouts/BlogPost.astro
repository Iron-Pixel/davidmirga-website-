---
import BaseLayout from './BaseLayout.astro';
import SocialCTA from '../components/SocialCTA.astro';

const { frontmatter } = Astro.props;

const content = await Astro.slots.render('default');
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

const categoryLabels: Record<string, string> = {
  'ki-sicherheit': 'KI-Sicherheit',
  'ki-praxis': 'KI-Praxis',
  'ki-strategie': 'KI-Strategie',
  'ki-wissen': 'KI-Wissen'
};
---

<BaseLayout pageTitle={frontmatter.title} description={frontmatter.description}>
  <article class="max-w-3xl mx-auto px-4 py-12">
    
    <span class="text-sm font-medium text-[#DC2626] uppercase tracking-wide">
      {categoryLabels[frontmatter.category]}
    </span>
    
    <h1 class="text-3xl md:text-4xl font-bold text-[#0B1F3F] mt-2 mb-4 font-['Manrope']">
      {frontmatter.title}
    </h1>
    
    <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-8">
      <span>{new Date(frontmatter.date).toLocaleDateString('de-AT')}</span>
      <span>·</span>
      <span>{frontmatter.author}</span>
      <span>·</span>
      <span>{readingTime} Min. Lesezeit</span>
    </div>
    
    {frontmatter.image && (
      <img 
        src={frontmatter.image} 
        alt={frontmatter.title}
        class="w-full rounded-lg mb-8"
        loading="lazy"
      />
    )}
    
    {frontmatter.video && (
      <div class="aspect-video mb-8">
        <iframe 
          src={frontmatter.video}
          class="w-full h-full rounded-lg"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
    )}
    
    <!-- ARTIKEL CONTENT -->
    <div class="prose prose-lg max-w-none text-[#0B1F3F]">
      <slot />
    </div>
    
    <!-- NEWSLETTER CTA (kompakt, zuerst) -->
    <div class="mt-12 pt-8 border-t-2 border-gray-200">
      <div class="bg-gradient-to-r from-[#0B1F3F] to-[#0B1F3F]/90 rounded-lg p-5 text-white">
        <h3 class="text-lg font-bold mb-2 font-['Manrope']">Mein Tipp:</h3>
        <p class="text-sm mb-3">
          Abonniere den <strong>KI im Puls</strong> Newsletter. Du bekommst professionelle Workflows, 
          praxisnahe Tools und klare Hintergrundinformationen – vieles abseits des Hypes.
        </p>
        <a 
          href="/abonnieren" 
          class="inline-block px-5 py-2 bg-[#DC2626] text-white text-sm font-bold rounded-lg hover:bg-red-700 transition-colors"
        >
          Hier anmelden
        </a>
      </div>
    </div>
    
    <!-- ÜBER MICH CTA (wenn deepDive aktiv) -->
    {frontmatter.deepDive && (
      <div class="mt-6">
        <div class="bg-[#F4F7F9] rounded-lg p-5 border-l-4 border-[#DC2626]">
          <p class="text-[#0B1F3F] text-sm">
            <strong>Falls du mehr zu mir und meinem Weg erfahren willst</strong> – und warum gerade ich diesen Artikel schreibe – 
            <a href="/ueber-mich" class="text-[#DC2626] font-semibold hover:underline">lies hier meine Geschichte (Über mich)</a>
          </p>
        </div>
      </div>
    )}
    
    <!-- SOCIAL MEDIA CTAs -->
    <div class="mt-12">
      <SocialCTA 
        linkedin={frontmatter.linkedin}
        instagram={frontmatter.instagram}
        x={frontmatter.x}
      />
    </div>
    
  </article>
</BaseLayout>